### Формализация правил и алгоритма решения задач на теорию игр

---

#### **Основные факты**

1. **Порядок ходов:**
   - Петя ходит первым, Ваня — вторым.
   
2. **Обозначения выигрыша/проигрыша:**
   - "+" — текущий игрок может выиграть из данной позиции.
   - "-" — текущий игрок проигрывает из данной позиции (соперник выигрывает).
   - Если начальное значение $S$ соответствует "+", то выигрывает Петя, если "-", то выигрывает Ваня.

3. **Стратегия игроков:**
   - Игроки всегда используют оптимальную стратегию, если в условии не указано иное.

4. **Операции:**
   - Возможные действия зависят от условия задачи (например, добавление камней, умножение, деление и т.д.).
   - Необходимо точно интерпретировать, что является "кучей", "камнями" и какими операциями можно манипулировать.

---

#### **Алгоритм расчета выигрышей/проигрышей**

1. **Определение конечных позиций:**
   - Найдите все значения $S$, из которых можно завершить игру за один ход (например, $S \geq 30$, если победное условие — $S \geq 30$).
   - Эти позиции помечаются как "+".

2. **Назначение проигрышных позиций:**
   - Позиция $S$ считается проигрышной ("-"), если **все возможные ходы** из этой позиции приводят к выигрышным позициям для соперника ("+ among all moves").

3. **Назначение выигрышных позиций:**
   - Позиция $S$ считается выигрышной ("+"), если **хотя бы один ход** из этой позиции приводит к проигрышной позиции для соперника ("- exists in moves").

4. **Построение таблицы:**
   - Отметьте все значения $S$, из которых можно выиграть за один ход.
   - Рассмотрите остальные значения $S$ по порядку (обычно от меньших к большим или наоборот, в зависимости от задачи).
   - Для каждого $S$ проверьте все возможные ходы и определите его статус ("+" или "-").

5. **Уточнение количества ходов:**
   - Для каждой позиции $S$:
     - Укажите минимальное количество ходов, за которое текущий игрок может выиграть.
     - Укажите минимальное количество ходов, за которое соперник может выиграть.

---

#### **Пример: Петя и Ваня, 1 куча камней**

##### **Условие:**
- Начальный диапазон: $1 \leq S \leq 29$.
- Возможные ходы:
  - Добавить 1 камень ($+1$).
  - Умножить количество камней на 3 ($\times 3$).
- Победа: $S \geq 30$.

---

##### **Решение:**

6. **Определение конечных позиций:**
   - Если $S \geq 10$, то игрок может выиграть за один ход ($S \times 3 \geq 30$).
   - Эти позиции помечаются как "+".

7. **Назначение проигрышных позиций:**
   - $S = 9$ все возможные ходы ($S + 1 = 10$, $S \times 3 = 27$) приводят к выигрышным позициям для соперника.
   - Следовательно, $S = 9$ — проигрышная позиция ("-").

8. **Назначение выигрышных позиций:**
   - $S = 8$: хотя бы один ход ($S + 1 = 9$) ведет в проигрышную позицию ("-").
   - Следовательно, $S = 8$ — выигрышная позиция ("+").

9. **Повторение процедуры для всех $S$:**
   - Построим таблицу $S$ с указанием статуса ("+" или "-") и количеством ходов до победы.

---

#### **Итоговая таблица:**

| $S$          | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10–29 |
|------------------|-----|-----|-----|-----|-----|-----|-----|-----|-----|-------|
| Статус $S$   | +   | -   | +   | +   | -   | +   | -   | +   | -   | +     |
| Победитель       | П4  | В3  | П2  | П4  | В3  | П3  | В2  | П2  | В1  | П1    |

---

#### **Ответы на вопросы**

10. **При каких $S$ Петя выигрывает первым ходом?**
   - $S \in [10, 29]$.

11. **При каких $S$ Ваня выигрывает первым ходом (при любой игре Пети)?**
   - $S = 9$.

12. **При каких $S$ Петя выигрывает вторым ходом (при любой игре Вани)?**
   - $S = 3,8$.

13. **При каких $S$ Ваня выигрывает первым или вторым ходом (при любой игре Пети)?**
   - $S = 7$.

14. **Минимальное $S$, при котором Ваня выигрывает первым ходом после неудачного хода Пети:**
   - $S = 4$.

---

#### **Выводы**

15. **Основные принципы:**
   - Из выигрышных позиций ("+") игрок всегда выбирает ход, ведущий к победе.
   - Из проигрышных позиций ("-") игрок не может избежать поражения, если противник играет оптимально.

16. **Правила определения статуса:**
   - Позиция $S$ помечается как "+", если существует хотя бы один ход, ведущий в "-" для соперника.
   - Позиция $S$ помечается как "-", если все возможные ходы ведут в "+" для соперника.

17. **Обратные операции:**
   - Для анализа задачи часто полезно использовать обратные операции:
     - Вместо $\times 3$ — используйте $\div 3$.
     - Вместо $+1$ — используйте $-1$.